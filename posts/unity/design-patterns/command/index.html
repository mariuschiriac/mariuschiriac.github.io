<!doctype html><html><head><title>Commmand Pattern</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="Commmand Pattern"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-GL0HTQZQGK','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/main-logo.png>Marius Chiriac</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/main-logo.png class=d-none id=main-logo>
<img src=/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/client-server/>Client Server</a><ul><li><a href=/posts/client-server/cookies/>Cookies in development</a></li><li><a href=/posts/client-server/migrate_js_ts/>Node: Migrate JS to TS</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/react/>React</a><ul><li><a href=/posts/react/migrate_js_ts/>React: Migrate JS to TS</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/unity/>Unity</a><ul class=active><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/unity/design-patterns/>Design Patterns</a><ul class=active><li><a href=/posts/unity/design-patterns/chain_of_responsibility/>Chain of Responsibility</a></li><li><a class=active href=/posts/unity/design-patterns/command/>Command</a></li><li><a href=/posts/unity/design-patterns/object_pool/>Object Pool</a></li><li><a href=/posts/unity/design-patterns/component/>Component</a></li></ul></li><li><a href=/posts/unity/webgl_integration/>javascript in WEBGL build</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/writing-posts/>Writing Posts</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/writing-posts/category/>Category</a><ul><li><a href=/posts/writing-posts/category/creating-category/>Creating Category</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/writing-posts/category/sub-category/>Sub-Category</a><ul><li><a href=/posts/writing-posts/category/sub-category/creating-sub-category/>Creating Sub-Category</a></li></ul></li></ul></li><li><a href=/posts/writing-posts/markdown-syntax-guide/>Markdown Guide</a></li><li><a href=/posts/writing-posts/using-emoji/>Using Emoji</a></li></ul></li><li><a href=/posts/analytics-and-comments/>Analytics & Comments</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://mariuschiriac.github.io/assets/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/avatar.png><h5 class=author-name>Marius Chiriac</h5><p>December 3, 2020</p></div><div class=title><h1>Commmand Pattern</h1></div><div class=post-content id=post-content><p>Behavioural Pattern.</p><hr><h2 id=pattern-explenation>Pattern explenation</h2><h3 id=intent>Intent</h3><p>Encapsulate a request as an object, thereby letting you parametrize clients with different requests, queue or log requests, and support undoable operations.</p><h3 id=what-it-solve>What it solve</h3><p>Need to issue requests to objects without knowing anything about the operation being requested or the receiver of the request.</p><h3 id=applications>Applications</h3><ul><li>To parameterize objects with respect to an action to be performed</li><li>To specify, queue and execute requests at different times</li><li>To allow the cancellation of operations</li><li>To organize a system into high-level operations which are themselves based on primitive operations</li></ul><h3 id=actors>Actors</h3><ul><li><strong>Command</strong><ul><li>Specifies an interface for performing a generic operation</li></ul></li><li><strong>ConcreteCommand</strong><ul><li>Defines a link between a target object and an action</li><li>Implement the <em>Execute</em> method by invoking the corresponding method (s) on the <em>Receiver</em></li><li>Keeps the data of the action</li></ul></li><li><strong>Client</strong><ul><li>Create a concrete instance of <em>Command</em> and set its <em>Receiver</em></li></ul></li><li><strong>Invoker</strong><ul><li>Asks <em>Command</em> to complete the request</li><li>Keeps the history of <em>ConcreteCommand</em> used</li></ul></li><li><strong>Receiver</strong><ul><li>Knows the way to perform the operations associated with a request. Any class can be seen as <em>Receiver</em></li></ul></li></ul><h3 id=schema>Schema</h3><img src=/images/design-patterns/command.gif class=center><h3 id=execution>Execution</h3><ol><li>Client <em>aClient</em> creates an <em>aCCommand</em> object and specifies its recipient <em>aReceiver</em></li><li>An <em>aInvoker</em> object stores the <em>aCCommand</em> object</li><li><em>aInvoker</em> forwards a request by calling the <em>Execute</em> method on the <em>aCCommand</em> command. If the commands support canceling,
<em>aCCommand</em> saves the state necessary to cancel the command before invoking <em>Execute</em></li><li>The <em>aCCommand</em> object invokes the operations necessary to perform the command on the <em>aReceiver</em> recipient</li></ol><p>The following diagram shows the interactions between these objects. Illustrates how the Command Pattern decouples the sender of a request from the recipient and the request itself.</p><img src=/images/design-patterns/command2.jpg class=center><h2 id=unity-example>Unity example</h2><img src=/images/design-patterns/command3.gif width=100% class=center><p>In this example we will see</p><h3 id=command-class>Command Class</h3><p><em>Command.cs</em></p><pre><code>public abstract class Command
{
    public abstract void Execute();
    public abstract void UnExecute();
}
</code></pre><h3 id=concretecommand-class>ConcreteCommand Class</h3><p><em>MoveCommand.cs</em></p><pre><code>using UnityEngine;

// A basic enum to describe our movement
public enum MoveDirection { up, down, left, right };

class MoveCommand : Command
{
    private MoveDirection _direction;
    private MoveReceiver _receiver;
    private float _distance;
    private GameObject _gameObject;


    //Constructor
    public MoveCommand(MoveReceiver reciever, MoveDirection direction, float distance, GameObject gameObjectToMove)
    {
        this._receiver = reciever;
        this._direction = direction;
        this._distance = distance;
        this._gameObject = gameObjectToMove;
    }


    //Execute new command
    public override void Execute()
    {
        _receiver.MoveOperation(_gameObject, _direction, _distance);
    }


    //Undo last command
    public override void UnExecute()
    {
        _receiver.MoveOperation(_gameObject, InverseDirection(_direction), _distance);
    }


    //invert the direction for undo
    private MoveDirection InverseDirection(MoveDirection direction)
    {
        switch (direction)
        {
            case MoveDirection.up:
                return MoveDirection.down;
            case MoveDirection.down:
                return MoveDirection.up;
            case MoveDirection.left:
                return MoveDirection.right;
            case MoveDirection.right:
                return MoveDirection.left;
            default:
                Debug.LogError(&quot;Unknown MoveDirection&quot;);
                return MoveDirection.up;
        }
    }


    //So we can show this command in debug output easily
    public override string ToString()
    {
        return &quot;MoveCommand : &quot; + MoveDirectionString(_direction) + &quot; : &quot; + _distance.ToString();
    }


    //Convert the MoveDirection enum to a string for debug
    public string MoveDirectionString(MoveDirection direction)
    {
        switch (direction)
        {
            case MoveDirection.up:
                return &quot;up&quot;;
            case MoveDirection.down:
                return &quot;down&quot;;
            case MoveDirection.left:
                return &quot;left&quot;;
            case MoveDirection.right:
                return &quot;right&quot;;
            default:
                return &quot;unkown&quot;;
        }
    }
}
</code></pre><p><em>ChangeColorCommand.cs</em></p><pre><code>using UnityEngine;

class ChangeColorCommand : Command
{
    private Color _color;
    private Color _previousColor;
    private ChangeColorReceiver _receiver;
    private SpriteRenderer _sr;

    //Constructor
    public ChangeColorCommand(ChangeColorReceiver reciever, Color color, GameObject gameObjectTarget)
    {
        this._receiver = reciever;
        this._color = color;
        this._sr = gameObjectTarget.GetComponent&lt;SpriteRenderer&gt;();
        this._previousColor = _sr.color;
    }

    //Execute new command
    public override void Execute()
    {
        _receiver.Execute(_sr, _color);
    }

    //Undo last command
    public override void UnExecute()
    {
        _receiver.Execute(_sr, _previousColor);
    }

    //So we can show this command in debug output easily
    public override string ToString()
    {
        return &quot;ChangeColorCommand : from &quot; +getColorName(_previousColor) + &quot; to &quot; + getColorName(_color);
    }

    private string getColorName(Color c)
    {
        string result = &quot;unknown&quot;;
        result = c.r &gt; 0.8f ? &quot;red&quot; : result;
        result = c.b &gt; 0.8f ? &quot;blue&quot; : result;
        result = c.g &gt; 0.8f ? &quot;green&quot; : result;
        return result;
    }

}
</code></pre><h3 id=receiver-class>Receiver Class</h3><p><em>MoveReceiver.cs</em></p><pre><code>using UnityEngine;

class MoveReceiver
{
    public void MoveOperation(GameObject gameObjectToMove, MoveDirection direction, float distance)
    {
        switch (direction)
        {
            case MoveDirection.up:
                MoveY(gameObjectToMove, distance);
                break;
            case MoveDirection.down:
                MoveY(gameObjectToMove, -distance);
                break;
            case MoveDirection.left:
                MoveX(gameObjectToMove, -distance);
                break;
            case MoveDirection.right:
                MoveX(gameObjectToMove, distance);
                break;
        }
    }

    private void MoveY(GameObject gameObjectToMove, float distance)
    {
        Vector3 newPos = gameObjectToMove.transform.position;
        newPos.y += distance;
        gameObjectToMove.transform.position = newPos;
    }

    private void MoveX(GameObject gameObjectToMove, float distance)
    {
        Vector3 newPos = gameObjectToMove.transform.position;
        newPos.x += distance;
        gameObjectToMove.transform.position = newPos;
    }
}
</code></pre><p><em>ChangeColorReceiver.cs</em></p><pre><code>using UnityEngine;

public class ChangeColorReceiver
{
    public void Execute(SpriteRenderer sr, Color color)
    {
        sr.color = color;
    }
}
</code></pre><h3 id=invoker-and-client-class>Invoker and Client Class</h3><p>In Unity it&rsquo;s easily to implement both invoker and client job on the same class. Because the Invoker needs the ConcreteCommands created by Client.
In the following code we will have:</p><p><strong>Client job</strong></p><ul><li>creates Receivers</li><li>creates and configures concrete command objects</li></ul><p><strong>Invoker job</strong></p><ul><li>call the execution of commands (Move, ChangeColor, Undo and Redo)</li><li>saving the history of commands and in what position you are in the history</li></ul><p><em>InputHandler.cs</em></p><pre><code>using UnityEngine;
using System.Collections.Generic;

public class InputHandler : MonoBehaviour
{
    public float moveDistance = 10f;
    public GameObject objectTarget;

    private MoveReceiver moveReceiver;
    private ChangeColorReceiver changeColorReceiver;
    private List&lt;Command&gt; commands = new List&lt;Command&gt;();
    private int currentCommandNum = 0;

    void Start()
    {
        moveReceiver = new MoveReceiver();
        changeColorReceiver = new ChangeColorReceiver();

        if (objectTarget == null)
        {
            Debug.LogError(&quot;objectTarget must be assigned via inspector&quot;);
            this.enabled = false;
        }
    }


    public void Undo()
    {
        if (currentCommandNum &gt; 0)
        {
            currentCommandNum--;
            Command Command = commands[currentCommandNum];
            Command.UnExecute();
        }
    }

    public void Redo()
    {
        if (currentCommandNum &lt; commands.Count)
        {
            Command Command = commands[currentCommandNum];
            currentCommandNum++;
            Command.Execute();
        }
    }

    private void InsertCommand(Command command)
    {
        commands.Insert(currentCommandNum++, command);
    }

    private void Move(MoveDirection direction)
    {
        Command command = new MoveCommand(moveReceiver, direction, moveDistance, objectTarget);
        command.Execute();
        InsertCommand(command);
    }

    private void ChangeColor(Color color)
    {
        Command command = new ChangeColorCommand(changeColorReceiver, color, objectTarget);
        command.Execute();
        InsertCommand(command);
    }


    //Simple move commands to attach to UI buttons
    public void MoveUp() { Move(MoveDirection.up); }
    public void MoveDown() { Move(MoveDirection.down); }
    public void MoveLeft() { Move(MoveDirection.left); }
    public void MoveRight() { Move(MoveDirection.right); }

    public void Blue() { ChangeColor(Color.blue); }
    public void Red() { ChangeColor(Color.red); }
    public void Green() { ChangeColor(Color.green); }

    //Shows what's going on in the command list
    void OnGUI()
    {
        string label = &quot;   start&quot;;
        if (currentCommandNum == 0)
        {
            label = &quot;&gt;&quot; + label;
        }
        label += &quot;\n&quot;;

        for (int i = 0; i &lt; commands.Count; i++)
        {
            if (i == currentCommandNum - 1)
                label += &quot;&gt; &quot; + commands[i].ToString() + &quot;\n&quot;;
            else
                label += &quot;   &quot; + commands[i].ToString() + &quot;\n&quot;;

        }
        GUI.Label(new Rect(0, 0, 400, 800), label);
    }

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.UpArrow))
        {
            MoveUp();
        }
        if (Input.GetKeyDown(KeyCode.DownArrow))
        {
            MoveDown();
        }
        if (Input.GetKeyDown(KeyCode.LeftArrow))
        {
            MoveLeft();
        }
        if (Input.GetKeyDown(KeyCode.RightArrow))
        {
            MoveRight();
        }
        if (Input.GetKeyDown(KeyCode.R))
        {
            Redo();
        }
        if (Input.GetKeyDown(KeyCode.U))
        {
            Undo();
        }
    }
}
</code></pre><h2 id=conclusion>Conclusion</h2><p>After the first implementation of Command Pattern it&rsquo;s easy to add new Behaviour by creating new ConcreteCommand and Receiver classes without changing the rest of the code.</p></div><div class=btn-improve-page><a href=https://github.com/mariuschiriac/mariuschiriac.github.io/edit/master/content/posts/unity/design-patterns/command.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/unity/design-patterns/chain_of_responsibility/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>Chain of Responsibility Pattern</span></a></div><div class="col-md-6 next-article"><a href=/posts/unity/design-patterns/component/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Component Pattern</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#pattern-explenation>Pattern explenation</a><ul><li><a href=#intent>Intent</a></li><li><a href=#what-it-solve>What it solve</a></li><li><a href=#applications>Applications</a></li><li><a href=#actors>Actors</a></li><li><a href=#schema>Schema</a></li><li><a href=#execution>Execution</a></li></ul></li><li><a href=#unity-example>Unity example</a><ul><li><a href=#command-class>Command Class</a></li><li><a href=#concretecommand-class>ConcreteCommand Class</a></li><li><a href=#receiver-class>Receiver Class</a></li><li><a href=#invoker-and-client-class>Invoker and Client Class</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>redarked@gmail.com</span></li><li><span>Phone:</span> <span>+39 3880947809</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">Â© 2021 Marius Chiriac.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script><script src=/assets/js/popper.min.js></script><script src=/assets/js/bootstrap.min.js></script><script src=/assets/js/navbar.js></script><script src=/assets/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/assets/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>