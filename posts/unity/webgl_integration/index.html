<!doctype html><html><head><title>Integration of javascript in Unity WEBGL build</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="Integration of javascript in Unity WEBGL build"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-GL0HTQZQGK','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/main-logo.png>Marius Chiriac</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/main-logo.png class=d-none id=main-logo>
<img src=/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/client-server/>Client Server</a><ul><li><a href=/posts/client-server/cookies/>Cookies in development</a></li><li><a href=/posts/client-server/migrate_js_ts/>Migrate JS to TS</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/react/>React</a><ul><li><a href=/posts/react/migrate_js_ts/>Migrate JS to TS</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/unity/>Unity</a><ul class=active><li><i class="fas fa-plus-circle"></i><a href=/posts/unity/design-patterns/>Design Patterns</a><ul><li><a href=/posts/unity/design-patterns/chain_of_responsibility/>Chain of Responsibility</a></li><li><a href=/posts/unity/design-patterns/command/>Command</a></li><li><a href=/posts/unity/design-patterns/object_pool/>Object Pool</a></li><li><a href=/posts/unity/design-patterns/component/>Component</a></li></ul></li><li><a class=active href=/posts/unity/webgl_integration/>javascript in WEBGL build</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/writing-posts/>Writing Posts</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/writing-posts/category/>Category</a><ul><li><a href=/posts/writing-posts/category/creating-category/>Creating Category</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/writing-posts/category/sub-category/>Sub-Category</a><ul><li><a href=/posts/writing-posts/category/sub-category/creating-sub-category/>Creating Sub-Category</a></li></ul></li></ul></li><li><a href=/posts/writing-posts/markdown-syntax-guide/>Markdown Guide</a></li><li><a href=/posts/writing-posts/using-emoji/>Using Emoji</a></li></ul></li><li><a href=/posts/analytics-and-comments/>Analytics & Comments</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://mariuschiriac.github.io/assets/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/avatar.png><h5 class=author-name>Marius Chiriac</h5><p>November 29, 2020</p></div><div class=title><h1>Integration of javascript in Unity WEBGL build</h1></div><div class=post-content id=post-content><p>In this guide we will see how to integrate javascript functions in unity game with WEBGL build</p><hr><h2 id=workflow>Workflow</h2><ol><li>from unity script call a plugin that comunicate to the script where the build is placed</li><li>the plugin function have only the work to call a javascript function of site environment</li><li>change the javascript function without rebuilding everytime</li></ol><h2 id=create-the-plugin>Create the plugin</h2><p><em>plugin.jslib</em></p><pre><code>var plugin = {
    CallFunction: function()
    {
        CustomFunction();
    }
};

mergeInto(LibraryManager.library, plugin);
</code></pre><p>You can change the function caller to handle parameters.
Simple numeric types can be passed to JavaScript in function parameters without requiring any conversion. Other data types will be passed as a pointer in the emscripten heap (which is really just a big array in JavaScript). For strings, you can use the <strong>Pointer_stringify</strong> helper function to convert to a JavaScript string.
Insert <em>plugin.jslib</em> file in unity assets folder.</p><p><em>NewBehaviourScript.cs</em></p><pre><code>using UnityEngine;
using System.Runtime.InteropServices;

public class NewBehaviourScript : MonoBehaviour {

    [DllImport(&quot;__Internal&quot;)]
    private static extern void CallFunction();

    void Start() {
        CallFunction();
    }
}
</code></pre><p>In that script we simply call a javascript function without a user input.</p><pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
  window.CustomFunction = function(){ window.alert('It is working!!'); };
&lt;/script&gt;
</code></pre><p>In the index.html of the webgl build output, add the javascript function that will be triggered by unity.</p><h2 id=integrate-user-actions>Integrate user actions</h2><p>When we try to open a new window (using window.open) from our custom javascript function the user will be notified, because it&rsquo;s a restricted function. We can bypass that using a user input on unity that trigger the javascript function, that function have to create a listener on other input action to open the window.</p><h3 id=use-case>use case:</h3><ol><li>the user click on unity gameobject</li><li>onmousedown event c# will call the javascript function throght jslib plugin</li><li>the javascript function create a listener on onmouseup event</li><li>when the user ends the click it trigger our function as user interaction, and the code will have the privilege to open new window without asks to user.</li></ol><h3 id=the-code>The code</h3><p>modify <em>plugin.jslib</em> to pass the URL</p><pre><code>var plugin = {
    CallFunction: function()
    {
        CustomFunction();
    },
    callOpenWindow: function(link){
        customFunction(Pointer_stringify(link));
    }
};

mergeInto(LibraryManager.library, plugin);
</code></pre><p>add the unity handler for onmousedown to attach at the object to be clicked</p><p><em>PressHandler.cs</em></p><pre><code>using UnityEngine;
using UnityEngine.EventSystems;
using System;
using UnityEngine.Events;

public class PressHandler : MonoBehaviour, IPointerDownHandler
{
 [Serializable]
 public class ButtonPressEvent : UnityEvent { }

 public ButtonPressEvent OnPress = new ButtonPressEvent();

 public void OnPointerDown(PointerEventData eventData)
 {
  OnPress.Invoke();
 }
}
</code></pre><p>create the method to be attached at PressHandler.OnPointerDown</p><p><em>NewBehaviourScript.cs</em></p><pre><code>using UnityEngine;
using System.Runtime.InteropServices;

public class NewBehaviourScript : MonoBehaviour {

    [DllImport(&quot;__Internal&quot;)]
    private static extern void CallFunction();
    [DllImport(&quot;__Internal&quot;)]
    private static extern void CallOpenWindow(string str);

    void Start() {
        CallFunction();
    }

    void Link(){
      CallOpenWindow(&quot;www.google.com&quot;);
    }
}
</code></pre><p>and that&rsquo;s all.</p></div><div class=btn-improve-page><a href=https://github.com/mariuschiriac/mariuschiriac.github.io/edit/master/content/posts/unity/webgl_integration.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/unity/design-patterns/object_pool/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>Object Pool Pattern</span></a></div><div class="col-md-6 next-article"><a href=/posts/client-server/cookies/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Cookies in development using localhost</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#workflow>Workflow</a></li><li><a href=#create-the-plugin>Create the plugin</a></li><li><a href=#integrate-user-actions>Integrate user actions</a><ul><li><a href=#use-case>use case:</a></li><li><a href=#the-code>The code</a></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>redarked@gmail.com.com</span></li><li><span>Phone:</span> <span>+393880947809</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">© 2021 Marius Chiriac.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script><script src=/assets/js/popper.min.js></script><script src=/assets/js/bootstrap.min.js></script><script src=/assets/js/navbar.js></script><script src=/assets/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/assets/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>